import { Request, Response } from "express";
import { RegisterService } from "../service/index.js";
import { Database } from "sqlite3";
import { RegisterRequest } from "@pkg-shared";

export const register = async (req: Request, res: Response, db: Database) => {
  const dto: RegisterRequest = req.body;
  const registerService = new RegisterService(db);

  const registerResult = await registerService.registerUser(dto);

  return res
    .status(201)
    .cookie("token", registerResult.token, {
      httpOnly: true,
      secure: true,
      sameSite: "lax",
      maxAge: 1000 * 60 * 60 * 24, // 1æ—¥
    })
    .send({
      success: true,
      value: {
        token: registerResult.token
      }
    });
}
