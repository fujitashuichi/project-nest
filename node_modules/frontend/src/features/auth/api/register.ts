import { apiClient } from "../../../lib/api-client";
import type { UserRegisterBodyType } from "../types/types.data";
import type { ApiResult, RegisterResult } from "../types/types.result";
import { RegisterResponseSchema } from "@pkg/shared"

export const registerUser = async (body: UserRegisterBodyType): Promise<RegisterResult> => {
  const response: ApiResult = await apiClient({
    path: "/api/register",
    method: "POST",
    body: body
  });

  if (!response.ok) {
    return {
      ok: false,
      error: new Error("register failed")
    }
  }

  const data = await response.json();
  const parsedData = RegisterResponseSchema.safeParse(data);

  if (!parsedData.success) {
    return {
      ok: false,
      error: new Error("invalid json: failed to get Token")
    }
  }

  return {
    ok: true,
    token: parsedData.data.token
  }
}
